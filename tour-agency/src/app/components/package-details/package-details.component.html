<!-- Loading indicator -->
<div *ngIf="isLoading" class="text-center py-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-2">Loading package details...</p>
</div>

<!-- Error message -->
<div *ngIf="errorMessage && !isLoading" class="alert alert-danger" role="alert">
  {{ errorMessage }}
</div>

<div class="package-details" *ngIf="package && !isLoading">
  <div class="container">
    <div class="row">
      <!-- Package Details -->
      <div class="col-md-8">
        <img [src]="package.image" [alt]="package.name" class="package-image mb-4">
        <h1 class="mb-4">{{ package.name }}</h1>
        
        <div class="package-info">
          <div class="d-flex align-items-center mb-3">
            <div class="rating me-3">
              <i *ngFor="let star of getStars(package.averageRating)" [class]="star"></i>
            </div>
            <span class="text-muted">({{ package.reviews?.length || 0 }} reviews)</span>
          </div>

          <p class="lead">{{ package.description }}</p>

          <div class="row mb-4">
            <div class="col-6 col-md-3">
              <div class="info-item">
                <i class="fas fa-clock"></i>
                <span>{{ package.duration }} days</span>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="info-item">
                <i class="fas fa-users"></i>
                <span>{{ package.groupSize }}</span>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="info-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ package.country }}</span>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="info-item">
                <i class="fas fa-tag"></i>
                <span>${{ package.basePrice }}</span>
              </div>
            </div>
          </div>

          <div class="highlights mb-4">
            <h3>Highlights</h3>
            <ul class="list-unstyled">
              <li *ngFor="let highlight of package.highlights">
                <i class="fas fa-check-circle text-success me-2"></i>
                {{ highlight }}
              </li>
            </ul>
          </div>

          <div class="itinerary">
            <h3>Itinerary</h3>
            <div *ngFor="let day of package.itinerary" class="mb-3">
              <h4>Day {{ day.dayNumber }}: {{ day.title }}</h4>
              <p>{{ day.description }}</p>
              <div class="itinerary-details">
                <p><strong>Accommodation:</strong> {{ day.accommodation }}</p>
                <p><strong>Meals:</strong> {{ day.meals }}</p>
                <div *ngIf="day.activities && day.activities.length > 0">
                  <p><strong>Activities:</strong></p>
                  <ul>
                    <li *ngFor="let activity of day.activities">{{ activity }}</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Booking Form -->
      <div class="col-md-4">
        <div class="booking-form">
          <h3>Book This Package</h3>
          <div class="price mb-4">
            <span class="amount">${{ package.basePrice }}</span>
            <span class="text-muted">/person</span>
          </div>

          <form [formGroup]="bookingForm" (ngSubmit)="submitBooking()">
            <div class="mb-3">
              <label for="guests" class="form-label">Number of Guests</label>
              <input type="number" class="form-control" id="guests" formControlName="guests" min="1">
              <div *ngIf="bookingForm.get('guests')?.invalid && bookingForm.get('guests')?.touched" class="text-danger">
                Please enter a valid number of guests
              </div>
            </div>

            <div class="mb-3">
              <label for="date" class="form-label">Travel Date</label>
              <input type="date" class="form-control" id="date" formControlName="date">
              <div *ngIf="bookingForm.get('date')?.invalid && bookingForm.get('date')?.touched" class="text-danger">
                Please select a date
              </div>
            </div>

            <div class="mb-3">
              <label for="specialRequirements" class="form-label">Special Requirements</label>
              <textarea class="form-control" id="specialRequirements" formControlName="specialRequirements" rows="3"></textarea>
            </div>

            <button type="submit" class="btn btn-primary w-100" [disabled]="!isLoggedIn">
              {{ isLoggedIn ? 'Book Now' : 'Login to Book' }}
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Booking Modal -->
<ng-template #bookingModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Book {{ selectedPackageType?.name }} Package</h5>
    <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <form #bookingForm="ngForm">
      <div class="mb-3">
        <label for="fullName" class="form-label">Full Name</label>
        <input type="text" class="form-control" id="fullName" [(ngModel)]="bookingData.fullName" name="fullName" required>
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" [(ngModel)]="bookingData.email" name="email" required>
      </div>
      <div class="mb-3">
        <label for="phone" class="form-label">Phone</label>
        <input type="tel" class="form-control" id="phone" [(ngModel)]="bookingData.phone" name="phone" required>
      </div>
      <div class="mb-3">
        <label for="travelDate" class="form-label">Travel Date</label>
        <input type="date" class="form-control" id="travelDate" [(ngModel)]="bookingData.travelDate" name="travelDate" required>
      </div>
      <div class="mb-3">
        <label for="numberOfPeople" class="form-label">Number of People</label>
        <input type="number" class="form-control" id="numberOfPeople" [(ngModel)]="bookingData.numberOfPeople" name="numberOfPeople" min="1" required>
      </div>
      <div class="mb-3">
        <label for="specialRequirements" class="form-label">Special Requirements</label>
        <textarea class="form-control" id="specialRequirements" [(ngModel)]="bookingData.specialRequirements" name="specialRequirements" rows="3"></textarea>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
    <button type="button" class="btn btn-primary" (click)="submitBooking()" [disabled]="!bookingForm.form.valid">Book Now</button>
  </div>
</ng-template>
